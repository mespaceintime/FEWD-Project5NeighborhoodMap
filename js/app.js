function ViewModel(){function e(){function e(){var e={consumerKey:"3mVw_1SgwXXaOPQR3_b6nA",consumerSecret:"jvsTuKvAKvzJ9xdPJ0y3ok1M-nw",accessToken:"DcC6j7kla3A2B8FbxJCD8i74sg9FOSU3",accessTokenSecret:"4tzxE8upq1OdgZ9b5Rv9_sndr2s",serviceProvider:{signatureMethod:"HMAC-SHA1"}},s=n.currentFilter(),r=n.currentLocation(),i={consumerSecret:e.consumerSecret,tokenSecret:e.accessTokenSecret};parameters=[],parameters.push(["eat",s]),parameters.push(["location",r]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",e.consumerKey]),parameters.push(["oauth_consumer_secret",e.consumerSecret]),parameters.push(["oauth_token",e.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var c={action:"http://api.yelp.com/v2/search",method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(c),OAuth.SignatureMethod.sign(c,i);var l=OAuth.getParameterMap(c.parameters);l.oauth_signature=OAuth.percentEncode(l.oauth_signature);var p=setTimeout(function(){alert("Your request search could not be processed. Please check your internet connection.")},2e3);$.ajax({url:c.action,data:l,cache:!0,dataType:"jsonp",jsonpCallback:"cb",success:function(e){clearTimeout(p),u().push(e.businesses)},complete:function(){var e=new google.maps.LatLngBounds,s=u()[0];for(t in u()[0])o(s),u()[0][t].address=(u()[0][t].location.display_address[0]+", "+u()[0][t].location.display_address[2]).toString(),void 0===u()[0][t].image_url&&(u()[0][t].image_url="http://placehold.it/5x5"),n.placesList.push(u()[0][t]),e.extend(a[t].position),map.fitBounds(e)}})}function s(){for(var e=0;e<a.length;e++)a[e].setMap(null);a.length=0,n.placesList([]),u().length=0}var r={zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.RIGHT_TOP},scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},panControl:!0,mapTypeControl:!0,MapTypeId:google.maps.MapTypeId.TERRAIN};map=new google.maps.Map(document.getElementById("gMap"),r);var i=new google.maps.LatLngBounds(new google.maps.LatLng(25,-125),new google.maps.LatLng(50,-55));map.fitBounds(i);var c=document.getElementById("places");c.index=5,map.controls[google.maps.ControlPosition.LEFT].push(c);var l=document.getElementById("navigation");l.index=1,map.controls[google.maps.ControlPosition.LEFT].push(l);var p=document.getElementById("location"),m={types:["(cities)"],componentRestrictions:{country:"us"}},u=(new google.maps.places.SearchBox(p,m),ko.observableArray([]));document.getElementById("nav-btn").addEventListener("click",function(){s(),e()})}function o(e){var o=new google.maps.Marker({id:e[t].id,map:map,position:new google.maps.LatLng(e[t].location.coordinate.latitude,e[t].location.coordinate.longitude),title:e[t].name,animation:google.maps.Animation.DROP,content:"<div style='text-align: center'><b>"+e[t].name+"</b></br><img src="+e[t].image_url+"></br>"+e[t].location.display_address[0]});a.push(o),google.maps.event.addListener(o,"click",function(){s.setContent(o.content),s.open(map,this),o.setAnimation(google.maps.Animation.DROP)})}var t,n=this;n.currentLocation=function(){var e=$("#location:input").val();return e},n.currentFilter=ko.observable(),n.placesList=ko.observableArray([]);var a=[];google.maps.event.addDomListener(window,"load",e);var s=new google.maps.InfoWindow;n.listClick=function(e){var o;for(o in a)if(a[o].id===e.id){o=a[o];break}map.panTo(o.position);var t="<div style='text-align: center'><b>"+e.name+"</b></br><img src="+e.image_url+"></br>"+e.address+"</div>";s.open(map,o),s.setContent(t),o.setAnimation(google.maps.Animation.DROP)}}var map,infoWindow;ko.applyBindings(new ViewModel);